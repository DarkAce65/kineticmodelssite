{% extends "base.html" %}
{% load markup %}
{% load gravatar %}

{% block title %}
{% if section != '' %}
RMG Thermodynamics {{ section|title }}
{% else %}
RMG Thermodynamics Database
{% endif %}
{% endblock %}

{% block extrahead %}
<style>
table.thermoEntryData {
    text-align: center;
    margin-bottom: 1em;
}

table.thermoEntryData td.key {
    font-weight: bold;
    text-align: right;
}

table.thermoEntryData td.equals {
    text-align: center;
}

table.thermoEntryData td.value {
    text-align: left;
}

table.thermoEntryData td.reference p {
    margin: 0px;
}
</style>

<script src="/media/thermo.js" type="text/javascript"></script>

<script src="/media/Highcharts/js/highcharts.js" type="text/javascript"></script>
<script src="/media/highcharts.theme.js" type="text/javascript"></script>

<script type="text/javascript">
jQuery(document).ready(function() {

    {% ifequal thermoData.0 "Group additivity" %}
    Tdata = [{% for T in entry.data.Tdata %}{{ T }}{% if not forloop.last %},{% endif %}{% endfor %}];
    Cpdata = [{% for Cp in entry.data.Cpdata %}{{ Cp }}{% if not forloop.last %},{% endif %}{% endfor %}];
    H298 = {{ entry.data.H298 }};
    S298 = {{ entry.data.S298 }};
    {% endifequal %}
    {% ifequal thermoData.0 "Wilhoit" %}
    Cp0 = {{ entry.data.cp0 }};
    CpInf = {{ entry.data.cpInf }};
    a0 = {{ entry.data.a0 }};
    a1 = {{ entry.data.a1 }};
    a2 = {{ entry.data.a2 }};
    a3 = {{ entry.data.a3 }};
    B = {{ entry.data.B }};
    H0 = {{ entry.data.H0 }};
    S0 = {{ entry.data.S0 }};
    {% endifequal %}
    {% ifequal thermoData.0 "NASA" %}
    var polynomials = new Array();
    var Tmin = new Array();
    var Tmax = new Array();
    {% for poly in entry.data.polynomials %}
    polynomials[{{ forloop.counter0 }}] = [{{ poly.cm2 }},{{ poly.cm1 }},{{ poly.c0 }},{{ poly.c1 }},{{ poly.c2 }},{{ poly.c3 }},{{ poly.c4 }},{{ poly.c5 }},{{ poly.c6 }}];
    Tmin[{{ forloop.counter0 }}] = {{ poly.Tmin }};
    Tmax[{{ forloop.counter0 }}] = {{ poly.Tmax }};
    {% endfor %}
    {% endifequal %}

    var Tlist = new Array();
    var Cplist = new Array();
    var Hlist = new Array();
    var Slist = new Array();
    var Glist = new Array();
    for (var i = 0; i < 201; i++) {
        T = i * 10;
        Cp = null;
        H = null;
        S = null;
        G = null;
        {% ifequal thermoData.0 "Group additivity" %}
        Cp = thermoGA_getHeatCapacity(, Tdata, Cpdata, H298, S298);
        H = thermoGA_getEnthalpy(T, Tdata, Cpdata, H298, S298);
        S = thermoGA_getEntropy(T, Tdata, Cpdata, H298, S298);
        G = H - T * S;
        {% endifequal %}
        {% ifequal thermoData.0 "Wilhoit" %}
        Cp = wilhoit_getHeatCapacity(T, Cp0, CpInf, a0, a1, a2, a3, B, H0, S0);
        H = wilhoit_getEnthalpy(T, Cp0, CpInf, a0, a1, a2, a3, B, H0, S0);
        S = wilhoit_getEntropy(T, Cp0, CpInf, a0, a1, a2, a3, B, H0, S0);
        G = H - T * S;
        {% endifequal %}
        {% ifequal thermoData.0 "NASA" %}
        for (var j = 0; j < polynomials.length; j++) {
            if (Tmin[j] <= T && T <= Tmax[j]) {
                Cp = nasaPolynomial_getHeatCapacity(T, polynomials[j]);
                H = nasaPolynomial_getEnthalpy(T, polynomials[j]);
                S = nasaPolynomial_getEntropy(T, polynomials[j]);
                G = H - T * S;
                break;
            }
        }
        {% endifequal %}

        if (T != null && Cp != null && H != null && S != null && G != null) {
            Tlist.push(T);
            Cplist.push(Cp);
            Hlist.push(H);
            Slist.push(S);
            Glist.push(G);
        }

    }

    jsMath.Synchronize(function() {
        plotHeatCapacity(Tlist, Cplist, 'plotCp');
        plotEnthalpy(Tlist, Hlist, 'plotH');
        plotEntropy(Tlist, Slist, 'plotS');
        plotFreeEnergy(Tlist, Glist, 'plotG');
    });

});
</script>
{% endblock %}

{% block navbar_items %}
<a href="{% url database.views.index %}">Database</a>
&raquo; <a href="{% url database.views.thermo %}">Thermodynamics</a>
&raquo; <a href="{% url database.views.thermo section=section %}">{{ section|title }}</a>
&raquo; <a href="{% url database.views.thermo section=section subsection=subsection %}">{{ databaseName }}</a>
&raquo; <a href="{% url database.views.thermoEntry section=section subsection=subsection index=entry.index %}">{{ entry.index }}. {{ entry.label }}</a>
{% endblock %}

{% block sidebar_items %}
{% endblock %}

{% block page_title %}{{ entry.index }}. {{ entry.label }}{% endblock %}

{% block page_body %}

<h2>Structure</h2>
<p>
{{ structure|safe }}
</p>

<h2>Thermodynamic Data</h2>
{% include "thermo/thermoModel.html" %}

<div id="plotCp" style="width: 500px; height: 300px; margin: auto;"></div>
<div id="plotH" style="width: 500px; height: 300px; margin: auto;"></div>
<div id="plotS" style="width: 500px; height: 300px; margin: auto;"></div>
<div id="plotG" style="width: 500px; height: 300px; margin: auto;"></div>

<h2>Reference</h2>
{% include "reference.html" %}

<h2>History</h2>
{% for date, username, action, description in entry.history %}
<table class="history">
<tr>
    <td rowspan="2" class="historyIcon">{% gravatar username 40 %}</td>
    <td class="historyText">{{ description|restructuredtext }}</td>
</tr>
<tr>
    <td class="historyMeta">{{ action|title }} by {{ username }} on {{ date }} <a>View details</a></td>
</tr>
</table>
{% endfor %}
<br/>

{% endblock %}
