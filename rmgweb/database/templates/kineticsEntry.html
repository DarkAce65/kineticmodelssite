{% extends "base.html" %}
{% load markup %}
{% load gravatar %}

{% block title %}
{% if section != '' %}
RMG Kinetics {{ section|title }}
{% else %}
RMG Kinetics Database
{% endif %}
{% endblock %}

{% block extrahead %}
<style>
table.kineticsEntryData {
    text-align: center;
    margin-bottom: 1em;
}

table.kineticsEntryData td.key {
    font-weight: bold;
    text-align: right;
}

table.kineticsEntryData td.equals {
    text-align: center;
}

table.kineticsEntryData td.value {
    text-align: left;
}

table.kineticsEntryData td.reference p {
    margin: 0px;
}
</style>

<script src="/media/kinetics.js" type="text/javascript"></script>

<script src="/media/Highcharts/js/highcharts.js" type="text/javascript"></script>
<script src="/media/highcharts.theme.js" type="text/javascript"></script>

<script type="text/javascript">
jQuery(document).ready(function() {

    {% ifequal kineticsData.0 "Arrhenius" %}
    kineticsModel = new ArrheniusModel(
        {{ entry.data.A }},
        {{ entry.data.n }},
        {{ entry.data.Ea }},
        {{ entry.data.T0 }},
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "ArrheniusEP" %}
    kineticsModel = new ArrheniusEPModel(
        {{ entry.data.A }},
        {{ entry.data.n }},
        {{ entry.data.alpha }},
        {{ entry.data.E0 }},
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "MultiArrhenius" %}
    kineticsModel = new MultiArrheniusModel([
        {% for arrh in entry.data.arrheniusList %}
        new ArrheniusModel({{ arrh.A }}, {{ arrh.n }}, {{ arrh.Ea }}, {{ arrh.T0 }}){% if not forloop.last %},{% endif %}
        {% endfor %}],
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "PDepArrhenius" %}
    kineticsModel = new PDepArrheniusModel(
        [{% for P in entry.data.pressures %}P{% if not forloop.last %},{% endif %}{% endfor %}],
        [
        {% for arrh in entry.data.arrhenius %}
            new ArrheniusModel({{ arrh.A }}, {{ arrh.n }}, {{ arrh.Ea }}, {{ arrh.T0 }}){% if not forloop.last %},{% endif %}
        {% endfor %}],
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }},
        {{ entry.data.Pmin }},
        {{ entry.data.Pmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "Chebyshev" %}
    kineticsModel = new ChebyshevModel([
        {% for row in kineticsData.1 %}
            [{% for col in row %}{{ col }}{% if not forloop.last %},{% endif %}{% endfor %}],
        {% endfor %}],
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }},
        {{ entry.data.Pmin }},
        {{ entry.data.Pmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "ThirdBody" %}
    kineticsModel = new ThirdBodyModel(
        new ArrheniusModel({{ entry.data.arrheniusHigh.A }}, {{ entry.data.arrheniusHigh.n }}, {{ entry.data.arrheniusHigh.Ea }}, {{ entry.data.arrheniusHigh.T0 }}),
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }},
        {{ entry.data.Pmin }},
        {{ entry.data.Pmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "Lindemann" %}
    kineticsModel = new LindemannModel(
        new ArrheniusModel({{ entry.data.arrheniusHigh.A }}, {{ entry.data.arrheniusHigh.n }}, {{ entry.data.arrheniusHigh.Ea }}, {{ entry.data.arrheniusHigh.T0 }}),
        new ArrheniusModel({{ entry.data.arrheniusLow.A }}, {{ entry.data.arrheniusLow.n }}, {{ entry.data.arrheniusLow.Ea }}, {{ entry.data.arrheniusLow.T0 }}),
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }},
        {{ entry.data.Pmin }},
        {{ entry.data.Pmax }}
    );
    {% endifequal %}
    {% ifequal kineticsData.0 "Troe" %}
    kineticsModel = new TroeModel(
        new ArrheniusModel({{ entry.data.arrheniusHigh.A }}, {{ entry.data.arrheniusHigh.n }}, {{ entry.data.arrheniusHigh.Ea }}, {{ entry.data.arrheniusHigh.T0 }}),
        new ArrheniusModel({{ entry.data.arrheniusLow.A }}, {{ entry.data.arrheniusLow.n }}, {{ entry.data.arrheniusLow.Ea }}, {{ entry.data.arrheniusLow.T0 }}),
        {{ entry.data.alpha }},
        {{ entry.data.T3 }},
        {{ entry.data.T1 }},
        {{ entry.data.T2 }},
        {{ entry.data.Tmin }},
        {{ entry.data.Tmax }},
        {{ entry.data.Pmin }},
        {{ entry.data.Pmax }}
    );
    {% endifequal %}

    var klist = [];
    for (var Tinv = 0.0005; Tinv < 0.0035; Tinv+=0.00001) {
        T = 1.0 / Tinv;
        k = kineticsModel.getRateCoefficient(T, 1e5);
        if (T != null && k != null) {
            klist.push([Tinv*1000, Math.log(k) / Math.LN10]);
        }
    }
    
    jsMath.Synchronize(function() {
        plotKinetics('plotk', [['', klist]]);
    });

});
</script>
{% endblock %}

{% block navbar_items %}
<a href="{% url database.views.index %}">Database</a>
&raquo; <a href="{% url database.views.kinetics %}">Kinetics</a>
&raquo; <a href="{% url database.views.kinetics section=section %}">{{ section|title }}</a>
&raquo; <a href="{% url database.views.kinetics section=section subsection=subsection %}">{{ databaseName }}</a>
&raquo; <a href="{% url database.views.kineticsEntry section=section subsection=subsection index=entry.index %}">{{ entry.index }}. {{ entry.label }}</a>
{% endblock %}

{% block sidebar_items %}
{% endblock %}

{% block page_title %}{{ entry.index }}. {{ entry.label }}{% endblock %}

{% block page_body %}

<h2>Reaction</h2>
<table>
    <tr>
        <td class="reactants">{{ reactants|safe }}</td>
        <td class="reactionArrow">{{ arrow|safe }}</td>
        <td class="reactants">{{ products|safe }}</td>
    </tr>
</table>
<br/>

<h2>Kinetic Data</h2>
{% include "kinetics/kineticsModel.html" %}

<div id="plotk" style="width: 500px; height: 300px; margin: auto;"></div>

<h2>Reference</h2>
{% include "reference.html" %}

<h2>History</h2>
{% for date, username, action, description in entry.history %}
<table class="history">
<tr>
    <td rowspan="2" class="historyIcon">{% gravatar username 40 %}</td>
    <td class="historyText">{{ description|restructuredtext }}</td>
</tr>
<tr>
    <td class="historyMeta">{{ action|title }} by {{ username }} on {{ date }} <a>View details</a></td>
</tr>
</table>
{% endfor %}
<br/>

{% endblock %}
